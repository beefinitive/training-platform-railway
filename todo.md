# Project TODO - منصة إدارة الدورات التدريبية

## قاعدة البيانات
- [x] جدول الدورات (courses) - اسم الدورة، المدرب، تاريخ البدء والانتهاء
- [x] جدول رسوم الدورات (course_fees) - دعم رسوم متعددة مع خصومات
- [x] جدول المتدربين (trainees) - بيانات المتدربين المسجلين
- [x] جدول تسجيلات الدورات (enrollments) - ربط المتدربين بالدورات والرسوم
- [x] جدول المصروفات (expenses) - الشهادات، المدرب، التسويق، الضريبة، أخرى

## واجهات API
- [x] CRUD للدورات
- [x] CRUD لرسوم الدورات
- [x] CRUD للمتدربين
- [x] CRUD للتسجيلات
- [x] CRUD للمصروفات
- [x] API للتقارير المالية الشهرية
- [x] API لحساب الإيرادات وصافي الأرباح

## واجهة المستخدم
- [x] تصميم عربي احترافي (RTL)
- [x] صفحة تسجيل الدخول
- [x] لوحة التحكم الرئيسية مع فلترة شهرية
- [x] صفحة إدارة الدورات
- [x] صفحة إعدادات الدورة (الرسوم والمصروفات)
- [x] صفحة المتدربين والتسجيلات
- [x] عرض إحصائيات الدورة (الإيرادات، المصروفات، صافي الربح)
- [x] تقارير مالية شهرية

## التقارير المالية
- [x] إجمالي الإيرادات
- [x] إجمالي المصروفات
- [x] صافي الأرباح
- [x] عدد المتدربين
- [x] فلترة بالأشهر

## اختبارات
- [x] اختبارات API للدورات
- [x] اختبارات API للمصروفات
- [x] اختبارات حساب الإيرادات


## تعديل نظام المتدربين (إحصائيات فقط)
- [x] تعديل جدول التسجيلات ليحتوي على عدد المتدربين بدلاً من ربط بمتدرب محدد
- [x] حذف جدول المتدربين (trainees) - لم يعد مطلوباً
- [x] تعديل API للتسجيلات لقبول عدد المتدربين مع نوع الرسوم
- [x] تحديث واجهة المستخدم لإدخال عدد المتدربين فقط
- [x] تحديث حسابات الإيرادات لتعتمد على العدد × الرسوم
- [x] إزالة صفحة المتدربين من القائمة الجانبية

## صفحة الإعدادات الرئيسية
- [x] إنشاء صفحة الإعدادات الرئيسية
- [x] إضافة إمكانية تغيير الشعار (رفع صورة)
- [x] إضافة إمكانية تغيير الألوان الرئيسية للمنصة
- [x] حفظ الإعدادات في قاعدة البيانات
- [x] تطبيق الألوان والشعار على جميع الصفحات

## تحسين نظام الدورات
- [x] إضافة إمكانية تعديل بيانات الدورة
- [x] إضافة إمكانية حذف الدورة مع الحفاظ على الإحصائيات
- [x] إضافة تأكيد قبل الحذف

## تطبيق الألوان والشعار على جميع الصفحات
- [x] إنشاء Context لإدارة إعدادات المنصة (الشعار والألوان)
- [x] تحميل الإعدادات عند بدء التطبيق
- [x] تطبيق الألوان على CSS variables
- [x] عرض الشعار في القائمة الجانبية
- [x] تحديث جميع العناصر لاستخدام الألوان المخصصة

## نظام ترقيم تلقائي للدورات
- [x] إضافة حقل courseCode إلى جدول الدورات
- [x] إنشاء دالة لتوليد الرقم الرمزي تلقائياً (رقم-شهر-سنة)
- [x] تحديث API لإنشاء الدورات ليشمل الترقيم التلقائي
- [x] عرض الرقم الرمزي في قائمة الدورات وتفاصيلها

## إصلاح الأخطاء
- [ ] إصلاح مشكلة حفظ الشعار في صفحة الإعدادات
## نظام إدارة المدربين
- [x] إنشاء جدول المدربين (الاسم، الصورة، رقم التواصل، الإيميل)
- [x] إنشاء API للمدربين (CRUD)
- [x] إنشاء صفحة إدارة المدربين
- [x] ربط المدربين بجدول الدورات
- [x] تعديل نموذج إنشاء الدورة لاختيار المدرب من القائمة
- [x] إضافة خيار إضافة مدرب جديد أثناء إنشاء الدورة
- [x] عرض معلومات المدرب في صفحة تفاصيل الدورة
- [x] إضافة إحصائية المدربين في لوحة التحكم

## قوالب الدورات
- [x] إنشاء جدول قوالب الدورات
- [x] إمكانية حفظ إعدادات الدورة كقالب (الرسوم، المدرب)
- [x] إمكانية إنشاء دورة جديدة من قالب محفوظ

## رسوم الدورة الافتراضية في القوالب
- [x] إضافة حقل defaultFees في جدول القوالب (JSON)
- [x] تحديث API القوالب لدعم الرسوم الافتراضية
- [x] تحديث واجهة حفظ القالب لإدخال الرسوم
- [x] تحديث واجهة إنشاء الدورة لتحميل الرسوم من القالب

## إصلاح الأخطاء
- [x] إصلاح مشكلة عدم اختفاء الدورة من القائمة بعد الحذف

## صفحة أرشيف الدورات المحذوفة
- [x] إضافة دالة لعرض الدورات المحذوفة فقط
- [x] إضافة دالة لاستعادة الدورة المحذوفة
- [x] إضافة API للأرشيف والاستعادة
- [x] إنشاء صفحة الأرشيف مع عرض الدورات الملغاة
- [x] إضافة زر استعادة الدورة
- [x] إضافة زر الحذف النهائي
- [x] إضافة رابط الأرشيف في القائمة الجانبية

## صفحة بيع الخدمات
- [x] إنشاء جدول الخدمات (اسم الخدمة، السعر، الكمية، التاريخ)
- [x] إنشاء API للخدمات (CRUD)
- [x] إنشاء صفحة بيع الخدمات
- [x] إضافة نموذج إدخال خدمة جديدة
- [x] عرض قائمة الخدمات المباعة
- [x] ربط الخدمات بالإيرادات في التقارير
- [x] إضافة إحصائية الخدمات في لوحة التحكم
- [x] إضافة رابط الخدمات في القائمة الجانبية

## قوالب الخدمات
- [x] إنشاء جدول قوالب الخدمات (اسم القالب، اسم الخدمة، السعر)
- [x] إنشاء API لقوالب الخدمات (CRUD)
- [x] إضافة زر حفظ كقالب في صفحة الخدمات
- [x] إضافة قائمة منسدلة لاختيار قالب عند إنشاء خدمة جديدة
- [x] تحميل بيانات القالب تلقائياً عند اختياره

## قوالب الخدمات
- [x] إنشاء جدول قوالب الخدمات (اسم القالب، اسم الخدمة، السعر)
- [x] إنشاء API لقوالب الخدمات (CRUD)
- [x] إضافة زر حفظ كقالب في صفحة الخدمات
- [x] إضافة قائمة منسدلة لاختيار قالب عند إنشاء خدمة جديدة
- [x] تحميل بيانات القالب تلقائياً عند اختياره

## المصروفات التشغيلية الشهرية
- [x] إنشاء جدول المصروفات التشغيلية (رواتب، كهرباء، مياه، إيجار، مصروفات حكومية، أخرى)
- [x] إنشاء API للمصروفات التشغيلية (CRUD)
- [x] إنشاء صفحة إدخال المصروفات التشغيلية الشهرية
- [x] ربط المصروفات التشغيلية بالتقارير الشهرية
- [x] خصم المصروفات التشغيلية من الإيراد العام
- [x] إضافة إحصائيات المصروفات التشغيلية في لوحة التحكم
- [x] إضافة رابط المصروفات التشغيلية في القائمة الجانبية

## إصلاح قائمة القوالب
- [x] فلترة القوالب لإظهار فقط الدورات الفعالة (غير المحذوفة)

## فحص مشكلة Test Course
- [x] فحص سبب ظهور Test Course عند إنشاء دورة جديدة (كانت الاختبارات تنشئ دورات فعلية)

## التقارير الدورية
- [x] إضافة تقارير ربعية (كل 3 أشهر)
- [x] إضافة تقارير نصفية (كل 6 أشهر)
- [x] إضافة تقارير سنوية
- [x] إضافة واجهة اختيار نوع التقرير في صفحة التقارير

## فلاتر البحث والفلترة
- [x] إضافة فلتر البحث بالكلمة في صفحة الدورات
- [x] إضافة فلتر الشهور في صفحة الدورات
- [x] إضافة فلتر البحث بالكلمة في صفحة الخدمات
- [x] إضافة فلتر الشهور في صفحة الخدمات
- [x] إضافة فلتر البحث بالكلمة في صفحة المدربين

## نظام المستهدفات الاستراتيجية
- [x] إنشاء جدول المستهدفات الاستراتيجية (الاسم، النوع، القيمة المستهدفة، السنة)
- [x] إنشاء جدول الشراكات (اسم الشريك، النوع: جهة/فرد، التاريخ، الوصف)
- [x] إنشاء جدول الأفكار النوعية (العنوان، الوصف، التاريخ، الحالة)
- [x] إنشاء API للمستهدفات (CRUD)
- [x] إنشاء API للشراكات (CRUD)
- [x] إنشاء API للأفكار (CRUD)
- [x] إنشاء صفحة المستهدفات الاستراتيجية مع لوحة متابعة
- [x] ربط المستهدفات بالبيانات الفعلية (الدورات، المتدربين، الأرباح)
- [x] إنشاء صفحة إدارة الشراكات
- [x] إنشاء صفحة إدارة الأفكار النوعية
- [x] إضافة روابط في القائمة الجانبية

## تعديل مستهدف الدورات الجديدة
- [x] تعديل حساب مستهدف "الدورات الجديدة" ليعتمد على عدد القوالب الفريدة
- [x] كل قالب جديد = دورة جديدة

## صفحة إدارة قوالب الدورات
- [x] إنشاء API لإدارة القوالب (إضافة، تعديل، حذف)
- [x] إنشاء صفحة عرض وإدارة القوالب
- [x] إضافة الرابط في القائمة الجانبية

## ربط الدورات بالقوالب
- [x] إضافة حقل templateId لجدول الدورات
- [x] تحديث API إنشاء الدورة لربطها بالقالب تلقائياً
- [x] عرض عدد مرات تكرار كل قالب في صفحة القوالب

## تطوير نظام المستهدفات
- [x] إضافة حقل خط الأساس (baseline) للمستهدفات
- [x] إضافة حقل الاسم المخصص للمستهدف
- [x] إمكانية تعديل خط الأساس والاسم
- [x] خط الأساس يتصفر في كل سنة جديدة
- [x] عرض إجمالي المستهدفات على مستوى كل السنوات

## إصلاح خطأ إضافة مدرب
- [x] إصلاح مشكلة رفع صورة المدرب (رفع الصورة إلى S3 بدلاً من حفظها في قاعدة البيانات)

## عرض مفردات المؤشرات في لوحة التحكم
- [x] جعل بطاقات المؤشرات قابلة للنقر
- [x] عرض قائمة الدورات عند النقر على "الدورات النشطة"
- [x] عرض قائمة المتدربين عند النقر على "عدد المسجلين"
- [x] عرض تفاصيل الإيرادات عند النقر على "إجمالي الإيرادات"
- [x] عرض تفاصيل المصروفات عند النقر على "إجمالي المصروفات"
- [x] عرض تفاصيل صافي الربح مع معادلة الحساب

## فحص مشكلة حساب الإيرادات
- [x] فحص حساب إيرادات شهر فبراير 2025 - الحساب صحيح (15,100 دورات + 3,900 خدمات = 19,000)
- [x] التأكد من صحة منطق حساب الإيرادات في الكود - صحيح

## نظام المستخدمين والصلاحيات
- [x] إنشاء جدول المستخدمين (الاسم، الإيميل، كلمة المرور المشفرة، الدور، الحالة)
- [x] إنشاء جدول الأدوار (مدير، مشرف، مستخدم)
- [x] إنشاء جدول الصلاحيات (إدارة الدورات، إدارة المدربين، إدارة التقارير، إلخ)
- [x] إنشاء جدول ربط الأدوار بالصلاحيات
- [x] إنشاء API للتسجيل بكلمة مرور
- [x] إنشاء API لتسجيل الدخول بكلمة مرور
- [x] دعم تسجيل الدخول عبر OAuth (الإيميل)
- [x] إنشاء API لإدارة المستخدمين (CRUD)
- [x] إنشاء API لإدارة الصلاحيات
- [x] إنشاء صفحة تسجيل الدخول (كلمة مرور + OAuth)
- [x] إنشاء صفحة التسجيل الجديد
- [x] إنشاء صفحة إدارة المستخدمين
- [x] إنشاء صفحة توزيع الصلاحيات
- [x] إنشاء hook للتحقق من الصلاحيات (usePermissions)
- [x] إنشاء مكون PermissionGate
- [x] كتابة اختبارات vitest
- [x] تطبيق الصلاحيات على جميع الصفحات (hook + PermissionGate)
- [x] إضافة روابط إدارة المستخدمين والأدوار في القائمة الجانبية

## نظام المشاريع المنفصلة (عزل الخدمات)
- [x] إنشاء جدول المشاريع (الاسم، الوصف، الحالة، تضمين في التقارير)
- [x] إضافة حقل projectId لجدول الخدمات
- [x] إنشاء API للمشاريع (CRUD)
- [x] إنشاء API لربط الخدمات بالمشاريع
- [x] تعديل حسابات الإيرادات لدعم فلترة المشاريع
- [x] تعديل التقارير لعرض/إخفاء خدمات المشاريع المستبعدة
- [x] إنشاء صفحة إدارة المشاريع
- [x] إضافة زر تضمين/استبعاد المشروع من التقارير
- [x] ربط خدمات "شموخ القرآن" بالمشروع المنفصل
- [x] اختبار استبعاد المشروع من التقارير - يعمل بنجاح

## تطبيق استبعاد المشاريع على جميع التقارير
- [x] ربط جميع خدمات شموخ القرآن بالمشروع (12 خدمة)
- [x] فحص دوال التقارير الربعية والنصفية والسنوية
- [x] التقرير الشهري - يستبعد المشاريع بنجاح
- [x] التقرير الربعي - يستبعد المشاريع بنجاح (Q3 2025: 3,494 ر.س. بدلاً من 13,994)
- [x] التقرير السنوي - يستبعد المشاريع بنجاح (2025: 12,410 ر.س. بدلاً من 52,310)
- [x] اختبار جميع أنواع التقارير - يعمل بنجاح

## نظام إدارة الموظفين
- [x] إنشاء جدول الموظفين (الاسم، التخصص، البريد، الهاتف، تاريخ التعيين، الحالة)
- [x] إنشاء جدول التخصصات (خدمة عملاء، تسويق، مدير تنفيذي، مبرمج، داعم)
- [x] إنشاء جدول مستهدفات الموظفين (الموظف، نوع المستهدف، القيمة المستهدفة، الفترة)
- [x] إنشاء جدول المكافآت (الموظف، المستهدف، قيمة المكافأة، الحالة)
- [x] إنشاء جدول الحضور والانصراف (الموظف، وقت الدخول، وقت الخروج، التاريخ)
- [x] إنشاء جدول تقارير الإنجاز اليومي (الموظف، التاريخ، العملاء المستهدفين، المؤكدين، المسجلين)
- [x] إنشاء جدول إحصائيات العملاء
- [x] إنشاء API للموظفين (CRUD)
- [x] إنشاء API للمستهدفات الفردية
- [x] إنشاء API للمكافآت (مع حساب الاستحقاق التلقائي)
- [x] إنشاء API للحضور والانصراف
- [x] إنشاء API لتقارير الإنجاز اليومي
- [x] ربط العملاء المؤكدين بإحصائيات العملاء (تلقائياً)
- [x] إنشاء صفحة إدارة الموظفين
- [x] إنشاء صفحة المستهدفات والمكافآت
- [x] إنشاء صفحة الحضور والانصراف
- [x] إنشاء صفحة تقارير الإنجاز اليومي (لخدمة العملاء)
- [x] إضافة الروابط إلى القائمة الجانبية
- [x] كتابة اختبارات vitest (12 اختبار ناجح)

## نظام رواتب الموظفين
- [x] إنشاء جدول الرواتب الشهرية (الموظف، الشهر، السنة، الراتب الأساسي، الصافي)
- [x] إنشاء جدول تعديلات الراتب (حسومات/مكافآت مع السبب والقيمة)
- [x] إنشاء API للرواتب (إنشاء، تعديل، عرض، توليد تلقائي)
- [x] إنشاء API لتعديلات الراتب (إضافة حسم/مكافأة)
- [x] دالة إعادة حساب صافي الراتب بعد التعديلات
- [x] إنشاء صفحة إدارة الرواتب (عرض، توليد، إضافة، تعديلات)
- [x] إضافة رابط الرواتب إلى القائمة الجانبية
- [x] كتابة اختبارات vitest (12 اختبار ناجح)
- [x] ربط الرواتب بمصروفات الشهر تلقائياً (عبر API جديد)


## إصلاح الأخطاء - الموظفين
- [x] إصلاح خطأ التحقق من البريد الإلكتروني (تغيير type من email إلى text)
- [x] إصلاح مشكلة فقدان التركيز عند الكتابة في الحقول (مشكلة re-rendering)
  - نقل مكون EmployeeForm خارج الـ component الرئيسي
  - استخدام useCallback لجميع دوال معالجة التغييرات
  - إصلاح خطأ SelectItem بتغيير القيمة الفارغة إلى all


## ربط الموظفين بحسابات المستخدمين (جديد)
- [x] إضافة حقل profileImage لتخزين رابط الصورة الشخصية
- [x] إضافة API procedures للبيانات الشخصية (البريد والجوال والصورة)
- [x] إنشاء صفحة الموظف الشخصية (EmployeeProfile)
- [x] عرض البيانات الشخصية (الاسم والبريد والجوال)
- [x] تعديل البريد والجوال
- [x] عرض المستهدفات ونسبة التقدم
- [x] عرض سجل الحضور والانصراف
- [x] عرض سجل الرواتب الشهرية
- [x] كتابة اختبارات Vitest (13 اختبار ناجح)
- [x] رفع الصورة الشخصية إلى S3
  - إضافة API procedure لرفع الصورة
  - إضافة زر رفع الصورة في الصفحة الشخصية
  - عرض الصورة بعد الرفع
  - كتابة 7 اختبارات Vitest
- [ ] إرسال بيانات الدخول (اختياري)
- [ ] تطبيق صلاحيات العرض: كل موظف يشوف بياناته فقط


## تعديل البيانات وإرسال بيانات الدخول
- [x] إضافة API procedure لإرسال بيانات الدخول عبر البريد الإلكتروني
- [x] إضافة زر "إرسال بيانات الدخول" في صفحة الموظفين
- [x] تطبيق صلاحيات العرض - كل موظف يشوف بياناته فقط
- [x] إضافة API procedures للبيانات الشخصية مع فحص الصلاحيات
- [x] كتابة 12 اختبار Vitest للميزات الجديدة


## ربط الموظفين بحسابات المستخدمين والأدوار
- [ ] إضافة حقل userId لجدول الموظفين (ربط بجدول المستخدمين)
- [ ] إنشاء دالة createEmployeeWithUser لإنشاء موظف مع حساب مستخدم تلقائياً
- [ ] إضافة API procedure لإنشاء موظف مع حساب
- [ ] إضافة dropdown لاختيار الدور في صفحة الموظفين
- [ ] إضافة API procedure لتحديث دور الموظف
- [ ] تطبيق فحص الصلاحيات على الصفحات بناءً على دور الموظف
- [ ] إضافة صفحة "إدارة أدوار الموظفين" (اختياري)
- [ ] كتابة اختبارات Vitest
- [ ] اختبار عملي: إضافة موظف وتعيين دور له


## الميزات المنجزة - ربط الموظفين بالأدوار والصلاحيات
- [x] إضافة دالة createEmployeeWithUser لإنشاء موظف مع حساب مستخدم تلقائياً
- [x] إضافة دالة updateEmployeeRole لتحديث دور الموظف
- [x] إضافة دالة getEmployeeWithRole لاسترجاع بيانات الموظف مع الدور
- [x] إضافة API procedures في routers.ts للدوال الجديدة
- [x] كتابة 5 اختبارات Vitest للميزات الجديدة
- [ ] إضافة dropdown لاختيار الدور في صفحة الموظفين (قيد التطوير)
- [ ] تطبيق صلاحيات العرض على الصفحات (قيد التطوير)


## إضافة dropdown لاختيار الدور في صفحة الموظف
- [x] إضافة dropdown لاختيار الدور في صفحة EmployeeProfile
- [x] إضافة API procedure listRoles لاسترجاع الأدوار
- [x] استخدام updateRole procedure الموجود
- [x] إضافة معالج التحديث في الصفحة
- [x] كتابة 4 اختبارات Vitest للدور

## إنشاء لوحة تحكم الموظف (Employee Dashboard)
- [x] تحليل المتطلبات وتصميم لوحة التحكم
- [x] إنشاء صفحة EmployeeDashboard
- [x] إضافة الإحصائيات الرئيسية (4 بطاقات)
- [x] إضافة البطاقات (Cards) لعرض البيانات الملخصة
- [x] إضافة رسوم بيانية (3 رسوم: عمودي، دائري، خطي)
- [x] إضافة جداول للحضور والرواتب والمستهدفات
- [x] إضافة فلاتر لاختيار الشهر والسنة
- [x] ربط الصفحة بالتطبيق


## إضافة dropdown الدور في نموذج تعديل الموظف
- [x] إضافة dropdown لاختيار الدور في نموذج تعديل الموظف
  - موظف عادي (يشوف بياناته فقط)
  - مسؤول (يشوف جميع البيانات)


## عرض بيانات الدخول للموظف بشكل يدوي
- [x] استخدام زر البريد (Mail icon) لعرض بيانات الدخول
- [x] إنشاء نافذة (Dialog) لعرض البريد والكلمة
- [x] إضافة زر نسخ لكل حقل على حدة
- [x] زر "نسخ البيانات كاملة" لنسخ البريد والكلمة معاً

## إضافة الشعار في صفحة الدخول
- [x] إضافة الشعار المحفوظ في الإعدادات ليظهر في صفحة الدخول


## إضافة زر إنشاء حساب للموظف
- [x] إضافة زر "إنشاء حساب" في صفحة الموظفين
- [x] استخدام API procedure createWithUser الموجود
- [x] عرض رسالة نجاح وبيانات الدخول عند إنشاء الحساب


## إزالة خيار Google من صفحة الدخول
- [x] إزالة زر تسجيل الدخول بـ Google
- [x] إزالة تبويب Sign Up (التسجيل الذاتي)
- [x] بقاء صفحة تسجيل دخول بسيطة بالبريد وكلمة المرور فقط


## إصلاح مشكلة تسجيل الدخول بالبريد والكلمة المرور
- [x] إصلاح مشكلة إعادة التوجيه لـ OAuth عند خطأ تسجيل الدخول
- [x] جعل تسجيل الدخول بالبريد والكلمة يعمل محلياً


## إصلاح خطأ roleId و openId عند إنشاء حساب جديد
- [x] إضافة roleId افتراضي عند إنشاء حساب جديد
- [x] إضافة openId صحيح (pwd_{userId}) عند إنشاء حساب جديد
- [x] إصلاح مشكلة تسجيل الدخول بالبريد والكلمة المرور
- [x] التأكد من أن الحساب الجديد يُنشأ ويسجل دخول بنجاح
- [x] اختبار إنشاء حساب جديد وتسجيل الدخول - يعمل بنجاح


## تنظيف قاعدة البيانات ونظام الصلاحيات
- [x] حذف جميع حسابات المستخدمين ما عدا Admin
- [x] نظام الصلاحيات موجود بالفعل
- [x] أدوار مختلفة (Admin, Supervisor, User)
- [x] ربط الأدوار بالصلاحيات
- [x] إنشاء حساب اختبار




## إصلاح الأخطاء - الأدوار والصلاحيات
- [x] حذف صفحة Permissions.tsx المكررة
- [x] إرجاع رابط "الأدوار والصلاحيات" في القائمة الجانبية ليشير إلى صفحة إدارة المستخدمين الأصلية (/users)


## إعادة بناء نظام الصلاحيات (نظام جديد يركز على المستخدم)
- [ ] حذف صفحة UsersManagement.tsx القديمة
- [ ] حذف جميع الجداول المتعلقة بالأدوار والصلاحيات القديمة من قاعدة البيانات
- [ ] إنشاء جدول جديد user_permissions (userId, permissionId)
- [ ] إنشاء قائمة شاملة بجميع الصلاحيات الممكنة (عرض، إضافة، تعديل، حذف) لكل صفحة/وحدة
- [ ] إنشاء API procedures للصلاحيات الجديدة
- [ ] إنشاء صفحة PermissionsManagement.tsx الجديدة
- [ ] إضافة رابط الصلاحيات في القائمة الجانبية
- [ ] كتابة اختبارات Vitest


## إعادة بناء نظام الصلاحيات (المرحلة الثانية)
- [x] حذف صفحات الأدوار والمستخدمين القديمة
- [x] إنشاء جدول userPermissions الجديد (ربط مباشر بين المستخدم والصلاحية)
- [x] إضافة دوال قاعدة البيانات الجديدة (getUserPermissions, grantPermissionToUser, removePermissionFromUser, setUserPermissions)
- [x] إنشاء API procedures للصلاحيات على مستوى المستخدم
- [x] إنشاء صفحة إدارة الصلاحيات الجديدة (PermissionsManagement.tsx)
- [x] عرض قائمة المستخدمين مع البحث
- [x] عرض جميع الصلاحيات مجمعة حسب الوحدة (module)
- [x] منح/سحب الصلاحيات للمستخدم مباشرة
- [x] كتابة 12 اختبار Vitest ناجح للصلاحيات الجديدة
- [x] إضافة الرابط في القائمة الجانبية


## نظام المستهدفات المتقدم لخدمة العملاء
- [ ] تعديل جدول customerStats ليشمل المستهدفات الجديدة (العملاء المستهدفين، المسجلين، المؤكدين، القدامى)
- [ ] إضافة حقل عدد الخدمات المباعة لكل موظفة
- [ ] إنشاء دوال قاعدة البيانات للمستهدفات الجديدة
- [ ] إنشاء API procedures للمستهدفات
- [ ] إنشاء صفحة إدارة مستهدفات خدمة العملاء
- [ ] إنشاء تقرير مقارنة أداء الموظفات الشهري
- [ ] إضافة رسوم بيانية لمقارنة الأداء
- [ ] إضافة ترتيب الموظفات حسب الأداء
- [ ] كتابة اختبارات Vitest
- [ ] إضافة الروابط في القائمة الجانبية


## تطوير صفحة إدارة الصلاحيات الشاملة
- [ ] إضافة API procedure لإنشاء مستخدم جديد مع الصلاحيات
- [ ] إضافة نموذج إضافة مستخدم جديد في صفحة الصلاحيات
- [ ] إدخال البيانات الشخصية (الاسم، الإيميل)
- [ ] إدخال كلمة المرور (يحددها المسؤول)
- [ ] اختيار الصلاحيات للمستخدم الجديد من نفس الصفحة
- [ ] إمكانية تعديل بيانات المستخدم
- [ ] إمكانية تغيير كلمة المرور
- [ ] كتابة اختبارات Vitest


## صفحة إدارة الصلاحيات الشاملة (الجديدة)
- [x] إنشاء صفحة PermissionsManagement.tsx
- [x] إضافة واجهة لاختيار المستخدم من القائمة
- [x] إضافة واجهة عرض صلاحيات المستخدم المختار
- [x] إضافة نموذج إضافة مستخدم جديد
- [x] إضافة حقول البيانات الشخصية (الاسم، الإيميل، كلمة المرور)
- [x] إضافة اختيار الصلاحيات للمستخدم الجديد من نفس النافذة
- [x] إضافة API procedure لإنشاء مستخدم مع صلاحيات (createUserWithPermissions)
- [x] كتابة اختبارات Vitest (7 اختبارات ناجحة)
- [x] حذف الـ permissions router المكرر
- [x] إصلاح جميع الأخطاء في الكود


## تطبيق الصلاحيات على جميع الصفحات
- [ ] تحديث usePermissions hook للتحقق من الصلاحيات بشكل صحيح
- [ ] تطبيق الصلاحيات على صفحة الدورات (إضافة، تعديل، حذف)
- [ ] تطبيق الصلاحيات على صفحة الخدمات (إضافة، تعديل، حذف)
- [ ] تطبيق الصلاحيات على صفحة المدربين (إضافة، تعديل، حذف)
- [ ] تطبيق الصلاحيات على صفحة الموظفين (إضافة، تعديل، حذف)
- [ ] تطبيق الصلاحيات على صفحة التقارير (عرض فقط)
- [ ] تطبيق الصلاحيات على صفحة الإعدادات (تعديل فقط للمسؤولين)
- [ ] تطبيق الصلاحيات على القائمة الجانبية (إظهار/إخفاء الروابط)
- [ ] اختبار جميع الصفحات والتأكد من عمل الصلاحيات


## تطبيق الصلاحيات على جميع الصفحات
- [x] إضافة usePermissions hook إلى صفحة الدورات
- [x] إضافة التحقق من الصلاحيات على أزرار الإضافة والتعديل والحذف في الدورات
- [x] إضافة usePermissions hook إلى صفحة المدربين
- [x] إضافة التحقق من الصلاحيات على أزرار الإضافة والتعديل والحذف في المدربين
- [x] إضافة usePermissions hook إلى صفحة الموظفين
- [x] إضافة التحقق من الصلاحيات على أزرار الإضافة والتعديل والحذف في الموظفين
- [x] إضافة usePermissions hook إلى صفحة الخدمات
- [x] إضافة التحقق من الصلاحيات على أزرار الإضافة والتعديل والحذف في الخدمات
- [x] إضافة usePermissions hook إلى صفحة التقارير
- [x] إضافة usePermissions hook إلى صفحة الإعدادات
- [x] إضافة التحقق من الصلاحيات على زر الحفظ في الإعدادات
- [x] إضافة صلاحيات الموظفين (EMPLOYEES_VIEW, CREATE, EDIT, DELETE) إلى PERMISSIONS


## إصلاح مشاكل الصفحات
- [x] إصلاح مشكلة أيقونة إنشاء مستخدم في صفحة الصلاحيات
- [x] إصلاح مشكلة فتح صفحة الموظفين


## إصلاح React Error #310 في صفحة الموظفين
- [x] البحث عن مشكلة useMemo والهوكس في صفحة الموظفين
- [x] إصلاح ترتيب الهوكس والشروط (indentation)


## إصلاح خطأ استدعاء usePermissions داخل map
- [x] إيجاد مكان استدعاء usePermissions داخل حلقة map
- [x] نقل usePermissions إلى أعلى الكومبوننت


## إصلاح مشكلة زر إنشاء المستخدم
- [x] البحث عن مشكلة زر إنشاء المستخدم في صفحة الصلاحيات
- [x] استبدال fetch بـ useMutation من tRPCprocedure


## إضافة ميزة إدارة كلمات المرور
- [ ] تحديث قاعدة البيانات بجدول لتتبع تاريخ تغيير كلمات المرور
- [ ] إضافة دوال قاعدة البيانات لتغيير كلمات المرور
- [ ] إنشاء API procedures لإدارة كلمات المرور
- [ ] إنشاء صفحة إدارة كلمات المرور مع صلاحيات مختلفة
- [ ] كتابة اختبارات Vitest شاملة
- [ ] اختبار الميزة في المعاينة والإنتاج


## إدارة كلمات المرور (Password Management)
- [x] إضافة جدول passwordHistory لتتبع تاريخ تغيير كلمات المرور
- [x] إنشاء دوال قاعدة بيانات لإدارة كلمات المرور (changePassword, adminChangePassword, resetPassword)
- [x] إضافة دوال للتحقق من الصلاحيات (canChangeOwnPassword, canChangeUserPassword)
- [x] إضافة دوال للحصول على السجلات (getPasswordHistory, getUserPasswordAudit)
- [x] إنشاء API procedures في tRPC للتعامل مع تغيير كلمات المرور
- [x] إنشاء صفحة PasswordManagement للواجهة الأمامية مع ثلاث تبويبات
- [x] كتابة اختبارات Vitest شاملة لجميع دوال إدارة كلمات المرور (15 اختبار)
- [x] إضافة صفحة إدارة كلمات المرور إلى الملاحة الرئيسية
- [x] إصلاح مشكلة الصلاحيات - الآن مستخدمو Admin يمكنهم تغيير كلمات مرور الآخرين
- [ ] إضافة توثيق شامل للميزة


## حذف جماعي للمستخدمين والموظفين
- [x] إضافة دالة deleteUsersByIds لحذف مستخدمين متعددين مع جميع بياناتهم المرتبطة
- [x] إضافة دالة deleteEmployeesByIds لحذف موظفين متعددين مع جميع بياناتهم المرتبطة
- [x] إضافة API procedures للحذف الجماعي (deleteMultipleUsers, deleteMultipleEmployees)
- [x] إضافة واجهة مستخدم لاختيار المستخدمين/الموظفين للحذف
- [x] إضافة تأكيد ثنائي المرحلة قبل الحذف
- [x] ربط الصفحات بالقائمة الجانبية


## كلمات المرور الضعيفة والبريد الاختياري
- [x] السماح بكلمات مرور ضعيفة عند تغيير الإدارة لكلمة المرور
- [x] إضافة خيار اختياري لإرسال البريد الإلكتروني عند تغيير كلمة المرور
- [x] تعديل دوال التحقق من كلمة المرور
- [x] تعديل API procedures لقبول معامل البريد الاختياري
- [x] تحديث واجهة المستخدم لإضافة checkbox للبريد الاختياري


## مشاكل وأخطاء
- [x] إصلاح خطأ OAuth callback failed عند تسجيل الدخول بمستخدم جديد - تم إضافة نظام تسجيل بدون OAuth
- [x] إضافة ProtectedRoute لإعادة توجيه المستخدمين غير المصرح لهم إلى صفحة Login
- [x] تعديل getLoginUrl للعودة إلى صفحة Login بدلاً من OAuth


## نظام التسجيل بدون OAuth
- [x] إنشاء API procedures لتسجيل الدخول بالبريد وكلمة المرور
- [x] إنشاء صفحة تسجيل دخول بالبريد وكلمة المرور
- [x] تعديل نظام المصادقة للسماح بالتسجيل بدون OAuth
- [x] اختبار نظام التسجيل الجديد


## تحسينات إدارة المستخدمين
- [ ] إضافة API procedure لتفعيل المستخدم
- [ ] إضافة زر تفعيل المستخدم في نافذة إنشاء مستخدم
- [ ] دمج صفحة الصلاحيات مع صفحة المستخدمين


## تحسينات إدارة المستخدمين (الجديدة)
- [x] إضافة API procedure لتفعيل المستخدم
- [x] إضافة زر تفعيل المستخدم في نافذة إنشاء مستخدم
- [x] دمج صفحة الصلاحيات مع صفحة المستخدمين
- [x] إضافة رابط إدارة المستخدمين في القائمة الجانبية


## إصلاح مشكلة تسجيل الدخول
- [x] إصلاح مشكلة عدم إعادة التوجيه بعد تسجيل الدخول الناجح
- [x] استخدام window.location.href بدلاً من setLocation لضمان إعادة تحميل الصفحة
- [x] إصلاح ProtectedRoute لاستخدام useEffect للتوجيه بدلاً من render phase
- [x] إصلاح authenticateRequest للتعامل مع المستخدمين المحليين (pwd_*)


## إصلاح صلاحيات المستخدمين
- [x] إخفاء عناصر الإدارة من القائمة الجانبية للمستخدمين العاديين
- [x] إضافة حماية للصفحات الإدارية (إدارة المستخدمين، كلمات المرور، الحذف الجماعي)
- [x] التحقق من دور المستخدم قبل عرض الصفحات المحمية


## دمج الصلاحيات وإنشاء نظام خدمة العملاء
- [ ] دمج صفحة الصلاحيات مع صفحة إدارة المستخدمين
- [ ] إنشاء دور "خدمة العملاء" (customer_service) مع صلاحيات محدودة
- [ ] تعديل القائمة الجانبية لعرض صفحة المستهدفات فقط لخدمة العملاء
- [ ] إنشاء صفحة "مستهدفاتي" لموظفي خدمة العملاء
- [ ] عرض المستهدف الشخصي ونسبة التحقيق لكل موظف
- [ ] إضافة واجهة إدخال المستهدفات الشهرية واليومية للـ Admin
- [ ] ربط المستهدفات بالموظف المحدد
- [ ] كتابة اختبارات Vitest


## دمج الصلاحيات وإنشاء نظام خدمة العملاء (مكتمل)
- [x] دمج صفحة الصلاحيات مع صفحة إدارة المستخدمين
- [x] إنشاء دور خدمة العملاء (customer_service) بصلاحيات محدودة
- [x] إنشاء صفحة "مستهدفاتي" لموظفي خدمة العملاء
- [x] عرض المستهدفات الشخصية لكل موظف خدمة عملاء
- [x] عرض نسبة الإنجاز لكل مستهدف
- [x] عرض المكافآت المستحقة
- [x] إضافة واجهة للـ Admin لإدخال المستهدفات الشهرية واليومية
- [x] إضافة زر تعديل القيمة الحالية للمستهدف
- [x] تحديث القائمة الجانبية لإظهار صفحة "مستهدفاتي" لخدمة العملاء
- [x] كتابة 13 اختبار Vitest للنظام الجديد


## إصلاحات ودمج صفحات الحذف
- [x] إصلاح مشكلة إعادة تفعيل المستخدم المعطل
- [x] دمج صفحة حذف المستخدمين الجماعي مع صفحة إدارة المستخدمين
- [x] دمج صفحة حذف الموظفين الجماعي مع صفحة الموظفين
- [x] إزالة روابط صفحات الحذف المنفصلة من القائمة الجانبية


## ربط المستخدم بالموظف وتعديل صلاحيات خدمة العملاء
- [x] تعديل صلاحيات خدمة العملاء لإخفاء لوحة التحكم
- [x] جعل صفحة "مستهدفاتي" هي الصفحة الرئيسية لخدمة العملاء
- [x] إضافة حقل employeeId في جدول المستخدمين
- [x] إضافة خيار ربط المستخدم بحساب موظف في صفحة إدارة المستخدمين
- [x] عرض اسم الموظف المرتبط في قائمة المستخدمين


## ربط المستهدفات تلقائياً بالموظف المرتبط
- [x] تعديل auth.me لإرجاع employeeId مع بيانات المستخدم
- [x] تعديل صفحة مستهدفاتي لاستخدام employeeId من بيانات المستخدم
- [x] عرض مستهدفات الموظف المرتبط تلقائياً


## إصلاح مشكلة عدم ظهور المستهدفات
- [x] التحقق من أن auth.me يرجع employeeId بشكل صحيح
- [x] إصلاح الكود لضمان وصول employeeId للواجهة الأمامية - تم تحسين منطق البحث ليشمل البحث في قائمة الموظفين والبريد الإلكتروني


## تحديث أنواع مستهدفات خدمة العملاء
- [x] تحديث أنواع المستهدفات لتشمل: العملاء المؤكدين، العملاء المسجلين في النموذج، الخدمات المباعة، العملاء المستهدفين
- [x] تحديث واجهة إضافة المستهدفات
- [x] تحديث صفحة مستهدفاتي لعرض الأنواع الجديدة


## صفحة إدارة الموظفين الموحدة
- [ ] إنشاء صفحة موحدة لإدارة الموظفين مع تبويبات (الموظفين، الرواتب، المستهدفات والمكافآت)
- [ ] دمج صفحة الموظفين (إضافة، تعديل، حذف)
- [ ] دمج صفحة الرواتب
- [ ] دمج صفحة المستهدفات والمكافآت
- [ ] إضافة خاصية ربط الموظف بمستخدم موجود
- [ ] إضافة خاصية إنشاء حساب مستخدم جديد للموظف
- [ ] تحديث القائمة الجانبية لإزالة الصفحات المنفصلة


## صفحة إدارة الموظفين الموحدة
- [x] إنشاء صفحة إدارة الموظفين الموحدة بتبويبات (الموظفين، الرواتب، المستهدفات، المكافآت)
- [x] دمج صفحة الموظفين الحالية
- [x] دمج صفحة الرواتب
- [x] دمج صفحة المستهدفات والمكافآت
- [x] إضافة خيار ربط الموظف بمستخدم موجود
- [x] إضافة خيار إنشاء حساب مستخدم جديد للموظف (قيد التطوير)
- [x] تحديث القائمة الجانبية لإظهار صفحة إدارة الموظفين الموحدة
- [x] 12 اختبار Vitest ناجح


## دمج حذف الموظفين ومستهدفات خدمة العملاء التلقائية
- [ ] دمج صفحة حذف الموظفين الجماعي ضمن صفحة إدارة الموظفين
- [ ] إضافة مستهدفات تلقائية لموظفي خدمة العملاء عند إنشائهم
- [ ] المستهدفات التلقائية: العملاء المؤكدين، العملاء المسجلين، الخدمات المباعة، إعادة الاستهداف


## إصلاح مشاكل صفحة إدارة الموظفين
- [x] إضافة حقل "القيمة المتحققة" في نافذة تعديل المستهدف
- [x] إصلاح مشكلة عرض إجمالي الرواتب (الرقم ملخبط - يظهر .00700.00200.00240.00) - تم إصلاحه باستخدام parseFloat

## نموذج الإحصائيات اليومية لخدمة العملاء
- [x] إنشاء جدول الإحصائيات اليومية (daily_stats) في قاعدة البيانات
- [x] إنشاء API لإضافة/تعديل/عرض الإحصائيات اليومية
- [x] إنشاء نموذج إدخال يومي في صفحة "مستهدفاتي"
- [x] ربط الإحصائيات اليومية بالمستهدفات الشهرية (تجميع تلقائي)
- [x] عرض سجل الإحصائيات اليومية في صفحة "مستهدفاتي"
- [x] تحديث القيمة المتحققة للمستهدفات تلقائياً من مجموع الإحصائيات اليومية
- [x] عرض الإحصائيات في التقارير الشهرية


## ميزة مراجعة وتأكيد الإحصائيات اليومية للمشرفين
- [x] إضافة حقل الحالة (status) وحقل المراجع (reviewedBy) وملاحظات المراجعة إلى جدول daily_stats
- [x] إنشاء API للمشرفين لعرض جميع الإحصائيات اليومية للموظفين
- [x] إنشاء API لتأكيد/رفض الإحصائيات مع إضافة ملاحظات
- [x] إنشاء صفحة "مراجعة الإحصائيات" للمشرفين
- [x] عرض حالة الإحصائية في صفحة "مستهدفاتي" للموظف
- [x] منع تعديل الإحصائيات المؤكدة من قبل الموظف


## تعديل حساب القيمة المتحققة وتقارير المستهدفات
- [x] إضافة حقل القيمة الأساسية (baseValue) إلى جدول employee_targets
- [x] تعديل منطق حساب القيمة المتحققة = القيمة الأساسية + مجموع الإحصائيات اليومية
- [x] تحديث واجهة تعديل المستهدفات للأدمن لإظهار القيمة الأساسية
- [x] إضافة قسم تقارير المستهدفات في صفحة إدارة الموظفين
- [x] عرض ملخص أداء كل موظف مع نسبة الإنجاز


## إصلاح نسبة الإنجاز العامة
- [x] تحديث حالة المستهدف تلقائياً إلى "achieved" عندما القيمة المتحققة >= القيمة المستهدفة
- [x] تعديل حساب نسبة الإنجاز العامة لتعتمد على القيم الفعلية (المتحققة/المستهدفة) وليس فقط عدد المستهدفات المحققة


## إضافة حقل مبلغ المبيعات للإحصائيات اليومية
- [x] إضافة حقل salesAmount إلى جدول daily_stats
- [x] تعديل mapping في updateEmployeeTargetsFromDailyStats لربط sales_amount بـ salesAmount
- [x] تحديث واجهة إدخال الإحصائيات اليومية لتشمل حقل مبلغ المبيعات


## زر إعادة تهيئة الإحصائيات وإصلاح صفحة التأكيد
- [x] إضافة زر "إعادة تهيئة الإحصائيات" لحذف جميع القيم المتحققة من المستهدفات
- [x] إضافة API لإعادة تهيئة الإحصائيات
- [x] إضافة حقل مبلغ المبيعات في صفحة تأكيد الإحصائيات للمشرفين


## إصلاح مشكلة إعادة تهيئة الإحصائيات
- [x] تعديل دالة resetEmployeeStats لتعيد القيمة الحالية (currentValue) والقيمة الأساسية (baseValue) للصفر تماماً


## تحسين نموذج المستهدفات
- [x] إزالة حقل تاريخ النهاية من النموذج وحسابه تلقائياً بناءً على الفترة وتاريخ البداية


## إضافة رقم الهوية وصورة الموظف
- [x] إضافة حقل رقم الهوية (nationalId) إلى جدول employees
- [x] إضافة حقل صورة الموظف (profileImage) إلى جدول employees
- [x] تعديل نموذج إضافة/تعديل الموظف لتشمل رقم الهوية ورفع الصورة
- [x] إنشاء API لرفع الصور إلى S3
- [x] عرض صورة الموظف في لوحة التحكم الخاصة به (DashboardLayout)


## إصلاح مشكلة حفظ صورة الموظف
- [ ] إصلاح عدم حفظ profileImage في قاعدة البيانات عند التحديث
- [ ] إصلاح عدم ربط userId بالموظف


## ربط المستهدفات بالدورات التدريبية
- [x] إضافة حقل courseId لجدول الإحصائيات اليومية (daily_stats)
- [x] إضافة حقل courseFee و calculatedRevenue لتخزين رسوم الدورة والإيراد المحسوب
- [x] تعديل API الإحصائيات اليومية لربطها بالدورة
- [x] تعديل واجهة إدخال الإحصائيات لاختيار الدورة أولاً
- [x] حساب الإيراد تلقائياً (عدد المؤكدين × رسوم الدورة)
- [x] إضافة الإيراد المحسوب لإيرادات الدورة المعنية (عبر courseEnrollments)
- [x] تعديل صفحة مستهدفاتي لعرض الدورات المتاحة واختيار الرسوم
- [x] اختبار النظام الجديد


## إصلاح صفحة الدورات
- [x] إضافة زر "إضافة دورة" في صفحة الدورات التدريبية (كان موجوداً لكن يحتاج صلاحية courses.create)


## نظام موافقة المشرف على الإحصائيات اليومية
- [x] إضافة حقل حالة الموافقة (pending, approved, rejected) لجدول daily_stats (موجود مسبقاً)
- [x] إضافة حقل معرف المشرف الذي وافق/رفض (reviewedBy - موجود مسبقاً)
- [x] إضافة حقل سبب الرفض (reviewNotes - موجود مسبقاً)
- [x] تعديل API لدعم الموافقة والرفض
- [x] تحديث صفحة مراجعة الإحصائيات للمشرف (إضافة عمود الدورة والإيراد المتوقع)
- [x] ربط الإيرادات بالدورة فقط بعد موافقة المشرف
- [x] اختبار النظام الجديد (تم التأكيد بنجاح)

## إصلاح صورة الموظف في لوحة التحكم
- [ ] التحقق من سبب عدم ظهور صورة الموظف
- [ ] إصلاح المشكلة


## إصلاح صلاحيات موظفي خدمة العملاء
- [x] تعديل الصلاحيات الافتراضية لموظفي خدمة العملاء (فقط صفحة مستهدفاتي)
- [x] إصلاح صلاحيات الموظفة غادة الحالية (roleId = 4 خدمة عملاء)
- [x] التأكد من إخفاء القائمة الجانبية للموظفين بدون صلاحيات (موجود في DashboardLayout)
- [x] ربط الموظفة غادة بالمستخدمة غادة


## إصلاح صفحة المدربين
- [x] إضافة زر إضافة مدرب في صفحة المدربين (كان موجوداً لكن يحتاج صلاحية instructors.create)


## تعديل نظام الإحصائيات اليومية
- [x] السماح بإدخال إحصائيات متعددة في نفس اليوم (بدلاً من تحديث السجل الموجود)
- [x] الإحصائيات تبقى قيد المراجعة حتى يؤكدها المشرف (موجود مسبقاً)


## تعديل عدد المتدربين في إحصائيات التسجيل
- [x] إضافة زر تعديل لكل صف في جدول إحصائيات التسجيل
- [x] إضافة API لتعديل عدد المتدربين مع تحديث الإيرادات (API موجود enrollments.update)
- [x] تحديث إنجازات الموظف في المستهدفات عند التعديل
- [x] التأكد من انعكاس التغييرات على جميع التقارير (يتم تحديث الإحصائيات اليومية والمستهدفات)


## تعديل ورفض## تعديل ورفض الإحصائيات في صفحة المراجعة
- [x] إضافة API لتعديل الإحصائيات مع مزامنة التقارير
- [x] إضافة زر تعديل لكل إحصائية في صفحة المراجعة
- [x] إضافة Dialog لتعديل الإحصائية (الدورة، الرسوم، عدد المؤكدين)
- [x] التأكد من انعكاس التعديلات على مستهدفات الموظف وإحصائيات الدورةستهدفات الموظف
- [ ] التأكد من انعكاس التعديلات على إحصائيات التسجيل في الدورة


## تحويل شموخ القرآن لمشروع مستقل
- [x] تحليل هيكل المشاريع الحالي
- [x] إضافة جداول إيرادات ومصروفات المشاريع (projectRevenues, projectExpenses)
- [ ] إنشاء API لإدارة إيرادات ومصروفات المشروع
- [ ] تحديث واجهة صفحة تفاصيل المشروع لعرض الإيرادات والمصروفات
- [ ] إضافة تقرير منفصل للمشروع يعرض الإيرادات والمصروفات وصافي الربح
- [ ] التأكد من فصل حسابات المشروع عن الدورات والخدمات


## صفحة تفاصيل المشروع مع إدارة الإيرادات والمصروفات المنفصلة
- [x] إنشاء صفحة ProjectDetails.tsx لعرض تفاصيل المشروع
- [x] إضافة ملخص مالي للمشروع (إجمالي الإيرادات، المصروفات، صافي الربح)
- [x] إضافة واجهة لإدارة إيرادات المشروع (إضافة، تعديل، حذف)
- [x] إضافة واجهة لإدارة مصروفات المشروع (إضافة، تعديل، حذف)
- [x] إضافة فلترة بالشهر والسنة
- [x] إضافة إحصائيات سنوية للمشروع
- [x] إضافة زر "التفاصيل والتقارير" في صفحة المشاريع
- [x] إضافة مسار /projects/:id في App.tsx
- [x] اختبار إضافة إيراد جديد - يعمل بنجاح
- [x] اختبار إضافة مصروف جديد - يعمل بنجاح


## إصلاح مشكلة تعديل الرسوم في مراجعة الإحصائيات
- [ ] فحص كود تعديل الرسوم في صفحة مراجعة الإحصائيات
- [ ] إصلاح مشكلة عدم انعكاس تعديل الرسوم على صفحة الدورة
- [ ] اختبار الإصلاح والتحقق من عمله


## إصلاح مشكلة تعديل الرسوم في مراجعة الإحصائيات
- [x] فحص كود تعديل الرسوم في صفحة مراجعة الإحصائيات
- [x] إصلاح مشكلة عدم انعكاس تعديل الرسوم على صفحة الدورة (البحث بالملاحظة إضافة لـ dailyStatId)
- [x] اختبار الإصلاح والتحقق من عمله


## تحسين صفحة الموظف - إحصائيات جديدة
- [ ] إضافة إحصائية الإيرادات المحصّلة من الإحصائيات اليومية للموظف
- [ ] تصحيح حساب أيام العمل ليعتمد على التواريخ الفريدة بدلاً من عدد الإحصائيات


## دمج صفحات الدورات والقوالب والمدربين
- [ ] إنشاء صفحة موحدة للدورات مع تبويبات (الدورات، القوالب، المدربين)
- [ ] تحديث القائمة الجانبية لإزالة الروابط المنفصلة
- [ ] اختبار الصفحة الموحدة والتأكد من عمل جميع الوظائف


## دمج صفحات الدورات والقوالب والمدربين
- [x] إنشاء صفحة موحدة CoursesHub.tsx مع 3 تبويبات
- [x] تبويب الدورات: عرض جميع الدورات مع البحث والفلترة
- [x] تبويب القوالب: عرض قوالب الدورات مع إمكانية الإضافة والتعديل والحذف
- [x] تبويب المدربون: عرض المدربين مع إحصائيات
- [x] تحديث القائمة الجانبية لإزالة الروابط المنفصلة (رابط واحد: إدارة الدورات)
- [x] تحديث App.tsx لاستخدام الصفحة الموحدة


## فلترة الدورات وتعديل اسم الدورة
- [ ] فلترة الدورات النشطة فقط في قائمة اختيار الدورة عند إضافة إحصائية يومية
- [ ] إضافة إمكانية تعديل اسم الدورة للأدمن
- [ ] التأكد من انعكاس تغيير اسم الدورة على جميع التقارير


## إضافة تبويب الموظفين في صفحة تفاصيل المشروع
- [ ] إنشاء جدول لربط الموظفين بالمشاريع مع نسبة الراتب (project_employees)
- [ ] إضافة API لإدارة موظفي المشروع (إضافة، تعديل، حذف)
- [ ] إضافة تبويب الموظفين في صفحة تفاصيل المشروع
- [ ] حساب تكلفة الموظفين تلقائياً وإضافتها للمصاريف


## إضافة رواتب الموظفين كمصاريف تشغيلية
- [ ] إضافة زر لاختيار الموظفين في صفحة المصروفات التشغيلية
- [ ] إضافة نافذة لاختيار الموظفين مع عرض رواتبهم
- [ ] إضافة API لإضافة رواتب الموظفين كمصاريف شهرية
- [ ] اختبار الميزة والتحقق من عملها


## إصلاح إجمالي الرواتب في صفحة إدارة الموظفين
- [x] فحص كود حساب إجمالي الرواتب وتحديد المشكلة
- [x] إصلاح مشكلة حساب إجمالي الرواتب (الآن يحسب من رواتب الموظفين النشطين)


## ربط الإيرادات المحصّلة بمستهدف مبلغ المبيعات
- [ ] فحص كود صفحة MyTargets وفهم كيفية حساب الإنجاز
- [ ] ربط الإيرادات المحصّلة بمستهدف مبلغ المبيعات (sales_amount)
- [ ] تحديث حساب نسبة الإنجاز ليشمل مبلغ المبيعات


## ربط الإيرادات المحصّلة بمستهدف مبلغ المبيعات
- [x] فحص كود صفحة MyTargets وفهم كيفية حساب الإنجاز
- [x] ربط الإيرادات المحصّلة بمستهدف مبلغ المبيعات (sales_amount)
- [x] تحديث حساب نسبة الإنجاز ليشمل مبلغ المبيعات
- [x] دمج بطاقة مبلغ المبيعات مع الإيرادات المحصّلة في صفحة مستهدفاتي
- [x] تنسيق عرض القيم المالية في بطاقات المستهدفات
- [x] كتابة اختبارات vitest (3 اختبارات ناجحة)


## إصلاح مشكلة عدم تحديث مبلغ المبيعات عند غادة
- [ ] فحص بيانات غادة في قاعدة البيانات (الإحصائيات والمستهدفات)
- [ ] التحقق من سبب عدم تحديث مستهدف sales_amount
- [ ] تحديث مستهدفات غادة بناءً على الإيرادات المحصّلة


## إظهار صورة الموظف في لوحة التحكم
- [ ] فحص كود عرض صورة المستخدم في لوحة التحكم
- [ ] تعديل الكود لعرض صورة الموظف بدلاً من الحرف الأول
- [ ] اختبار التعديلات


## إضافة رسوم بيانية لمستهدفات الموظف
- [ ] إضافة رسم بياني دائري لنسب إنجاز المستهدفات
- [ ] إضافة رسم بياني شريطي لمقارنة المحقق بالمستهدف
- [ ] تحسين عرض البيانات في صفحة مستهدفاتي


## ربط WPForms بالمنصة لتحديث العملاء المسجلين تلقائياً
- [ ] إضافة حقل رمز الموظف (employeeCode) في قاعدة البيانات
- [ ] إضافة حقل رمز الموظف في واجهة إدارة الموظفين
- [ ] إنشاء API Webhook لاستقبال بيانات WPForms
- [ ] ربط الـ Webhook بتحديث العملاء المسجلين للموظف
- [ ] اختبار النظام
- [ ] توثيق طريقة الإعداد في WPForms
